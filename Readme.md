# HospitalSimulation
## 类说明
1. HosDept：医院科室，每种科室定义为一个对象，该类定义时需输入科室名（Name）、该科室拥有诊室数（Number）、该科室治疗所需时间（RequiredTime）。该类中包含两个函数：Use函数输入变量为科室对象，输出变量为整数数值，输出值为0表示该科室所有诊室都在使用中，否则输出可用的诊室编号并将该诊室标记为使用中；HosTimeGo函数输入变量为科室对象，调用一次该函数表示该科室对象经过1个时间步（1分钟）的过程，该科室中每个治疗中的诊室的剩余治疗时间减1分钟，若有某个或某些诊室治疗完毕（剩余治疗时间为0），则返回对应的诊室编号，否则返回空集。
2. Patient：病人，每个病人定义为一个对象，该类定义时需输入姓名（Name）、伤情等级（Level）、当前状态（Status）、到达医院时刻（ArriveTime）、致死等待时间（DeadTime），另有参数WaitTime记录病人来到医院后到最终救治完成前（确定出院或死亡）的等待时间、参数History记录病人来到医院后每个时间步的状态历史。其中状态（Status）值为-2表示因等待死亡，-1表示治疗失败死亡，0表示治愈出院，x（x=1，2，……）表示正在第x科室治疗，x.5（如1.5、2.5）表示正在第x科室前排队等待。该类中包含一个函数：PatTimeGo函数输入变量为病人对象，调用一次该函数表示该病人对象经过1个时间步（1分钟）的过程，若经过这1分钟人员因等待时间达到致死等待时间而死亡，则输出变量为该病人死亡前在等待哪个科室治疗，否则输出变量为0。

## 变量说明
1. Time：模拟时长，建议设置较大的值以处理完全部的排队病人。
2. MaxPatNum：病人人数上限，若模拟时长足够长，生成的病人数达到该上限后便不再生成新病人。
3. MeanInterval：病人平均到达时间间隔，即泊松分布中的重现期。
4. NumofHosDept：医院内的科室种类数。
5. AllDept：医院内的全部科室，1行NumofHosDept列的元胞数组，其中的每个元素都是HosDept类的对象，代表医院的一种科室。
6. NumofHurLev：伤情等级数。
7. P_HurLev：每种伤情等级的出现概率，1行NumofHurLev列的矩阵，矩阵所有元素的和为1。
8. DeadTime：每种伤情等级的致死等待时间，1行NumofHurLev列的矩阵。
9. HosMatrix：1行NumofHurLev列的元胞数组，元胞数组中的每个元素都是(NumofHosDept+1)行(NumofHosDept+2)列的矩阵，表示该伤情等级下病人在医院内的转换矩阵，转换矩阵的格式如下表所示，每行表示病人从某科室出来（或刚到达医院）时下一步前往各科室的概率，每行元素的和为1。

转换矩阵|去A科室|去B科室|……|出院|死亡
-|-|-|-|-|-
到达后| 
出A科室后|
出B科室后|
……|
|

10. AllPatient：所有病人，1行MaxPatNum列的元胞数组，元胞数组中的每个元素都是Patient类的对象，代表一个病人。若模拟时长较短或人数上限设置较大，有可能实际生成的病人数没有达到设定的病人人数上限MaxPatNum，此时该元胞数组中超出实际生成病人数的列数的元素为空集。
11. StatNum：统计人数，1行(NumofHurLev+1)列元胞数组。元胞数组中的每个元素都是4行Time列的矩阵，第1个矩阵统计了所有伤情等级的总人数，后面的每个矩阵统计了一种伤情等级的人数。每个矩阵中，每列表示一个时间步，第1行记录该时间步的到达人数，第2行记录该时间步的治愈人数，第3行记录该时间步因等待而死亡的人数，第4行记录该时间步因治疗失败而死亡的人数。
12. HospitalHistory：记录医院中各科室下各诊室在每个时间步治疗的病人编号，1行NumofHosDept列的元胞数组。元胞数组中的每个元素都是矩阵，矩阵的每行表示该科室下的一个诊室，矩阵的每列表示一个时间步，矩阵的值为该时间步中在该诊室中治疗的病人编号。
13. NumofPat：当前累计病人人数，初始为0，每生成一个病人该变量值加1。
14. WaitList：各科室的等待列表，1行NumofHosDept列的元胞数组。元胞数组中的每个元素都是行向量，表示正在等待该科室治疗的病人编号，初始为空集，每有一个病人需要该科室治疗，便在该行向量末尾加入该病人的编号。当该科室中有诊室为空闲时，从该行向量的开头取出病人的编号送入诊室治疗，并从行向量的开头中删除该病人的编号。
15. TotalNum：统计人数，1行(NumofHurLev+1)列元胞数组，格式与StatNum相同，StatNum是每个时间步新增数量，TotalNum是从开始到该时间步的累计数量。
16. PatientHistory：记录所有病人在每个时间步的状态，NumofPat行Time列矩阵，每行表示一个病人，每列表示一个时间步。在到达前矩阵中对应的元素值为0，到达后的值即为对应Patient对象中的History参数值。

## 子函数说明
RandomChoose函数：输入变量为行向量，输出值为1到该行向量的列数之间的某个随机整数（包含1和列数）。输入的行向量的每个元素表示取到该列数的概率，其和为1。该子函数根据取到各列的概率随机取一个列数值并返回。

## 程序流程

按时间循环下列流程：

1. 新病人到达并进入对应科室的等待队列

若当前累计病人人数还未到病人人数上限，则根据泊松分布生成当前时刻的病人数，并随机赋予其伤情等级。

2. 等待的人进入空闲科室

遍历各科室，若有人在等待该科室的治疗，再检查该科室是否有空闲诊室，若有，则将排在队伍最前的病人送入该诊室。

3. 时间经过1min（治疗/等待）

遍历所有病人并调用PatTimeGo函数，若有人因等待而死亡，将其从等待队列中移除；遍历所有科室并调用HosTimeGo函数，记录在该时间步完成治疗的诊室编号。

4. 治疗完毕的人离开科室并产生结果

遍历所有科室，若有某个或某些诊室治疗完毕，根据转换矩阵确定治疗完毕的病人的下一步去向。

5. 将各伤情等级的人数统计矩阵相加得到总的人数统计矩阵

将各伤情等级每时间步的治愈人数、因等待死亡人数、因治疗失败死亡人数相加，得到该时间步总的治愈人数、因等待死亡人数、因治疗失败死亡人数。